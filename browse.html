<!DOCTYPE html>
<html>
<head>
<title>Alfaerie Omega: Browser</title>
<script src="https://ajax.googleapis.com/ajax/libs/dojo/1.5/dojo/dojo.xd.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.3.0/mootools-yui-compressed.js"></script>
<script>
var COLORS = ["w", "b", "y", "r", "g", "c", "o", "p", "e", "k"];
var INDEX = null;

// Initialize
window.addEvent("domready", function() 
{
    var req, field;

    field = $("q");
    field.focus();
    field.addEvents({keyup: update});

    req = new Request.JSON({method:"get", url:"index.json", 
            onSuccess:function(response) {
                INDEX = response;
                update();
            },
            onFailure:function(response,value) {
                alert("Failed to fetch index: " + response + " " + value);
            },

            // I really don't know why I have to do this
            isSuccess:function() {
                return true;
            }
        });
    req.get();
});

// Update the search results
function update()
{
    var q = document.getElementById("q").value;
    var hits = 0;
    var html = "";

    for (var name in INDEX) {
        var info = INDEX[name];
        var tags = info.tags;

        if (name.contains(q) || (tags && tags.contains(q))) {
            hits += 1;

            for (var i = 0; i < COLORS.length; i += 1) {
                var color = COLORS[i];
                var path = "";

                html += '<img src="' + path + color + name + '.gif">';
            }
            html += name + "<br>";
        }
    }
    document.getElementById("s").innerHTML = html;
    window.status = "Found " + hits;
}
</script>
</head>
<body>
<div style="height: 600px; width: 750px">
<input name="q" id="q" type="search" style="width: 100%" onchange="update()">
<div style="border: 1px solid black; height: 100%; width: 100%; overflow: auto">
<span id="s"></span>
</div>
</div>
</body>
</html>
