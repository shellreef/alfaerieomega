<!DOCTYPE html>
<html>
<head>
<title>Alfaerie Omega: Browser</title>
<script src="https://ajax.googleapis.com/ajax/libs/dojo/1.5/dojo/dojo.xd.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/mootools/1.3.0/mootools-yui-compressed.js"></script>
<script>
var INDEX = null;

window.addEvent("domready", function() 
{
    var req, field;

    field = $("q");
    field.focus();
    field.addEvents({keyup: update});

    req = new Request.JSON({method:"get", url:"index.json", 
            onSuccess:function(response) {
                loadLibrary(response);
            },
            onFailure:function(response,value) {
                console.log("failed to fetch index",response,value);
            },

            // I really don't know why I have to do this
            isSuccess:function() {
                return true;
            }
        });
    req.get();
});

function loadLibrary(index)
{
    INDEX = index;

    for (var name in index) {
        var info = index[name];

    }
}

function update()
{
    var q = document.getElementById("q").value;
    var hits = [];
    var html = "";

    console.log(q);
    for (var name in INDEX) {
        var info = INDEX[name];

        if (name.contains(q)) {
            hits.push(name);

            // TODO: make not suck
            html += "<img src=w"+name+".gif><img src=b"+name+".gif>" + name +"<br>";
            console.log(name,info);

        }
    }
    document.getElementById("s").innerHTML = html;
}
// TODO: fancy searchable browser
</script>
</head>
<body>
<div style="border: 1px solid black; height: 600px; width: 700px; overflow: auto">
<input name="q" id="q" type="search" style="width: 100%" onchange="update()">
<span id="s"></span>
</div>
</body>
</html>
